<html>

<head>
  <!--<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">-->
  <title>Demo</title>
  <script src="jquery.js"></script>
  <script src="init.js"></script>
<!--  <script src="utility.js"></script>-->
  <script>
    $("document").ready(function() {
      $.ajaxSetup({
        cache: false
      });

      $.getJSON('ajax/status', {}, function(data) {
        var fileExist = data.file;
        //alert(fileExist);
        if (fileExist) {
          document.getElementById("download").disabled = false;
        }

      });

      $(".xyc").click(function() {
        var mode = $(this).attr('value');
        $.getJSON('ajax/xy', {
          mode: mode
        }, function(data) {

        });
      });

      $(".scan").click(function() {
        //console.log("scan!");
        document.getElementById("reading").innerHTML = "RUNNING";
        document.getElementById("reading").disabled = true;
        var mode = $(this).attr('value');
        $.getJSON('ajax/read', {
          mode: mode
        }, function(data) {
          console.log("Scan command");
        }).fail(function() {
          document.getElementById("reading").innerHTML = "&nbspSCAN";
          document.getElementById("reading").disabled = false;
          console.log("Error");
        }).done(function() {
          document.getElementById("reading").innerHTML = "&nbspSCAN";
          document.getElementById("reading").disabled = false;
          document.getElementById("download").disabled = false;
          console.log("success");
        });
      });

      $(".ledtoggle").click(function() {
        var ledstate = $(this).attr('value');
        if (ledstate == 1) {
          $(this).attr("value", "0");
        } else {
          $(this).attr("value", "1");
        }
        console.log(ledstate);
        $.getJSON('ajax/led', {
          value: ledstate
        }, function(data) {
          $("#display-led").text(data.value);
        });
      });

      // var forceCSV = getURLParameter("fcsv");
      // if (forceCSV == 1) {
      //   document.getElementById("download").disabled = false;
      // }
    });
  </script>
</head>

<body active="DEMO">
    <noscript>This software uses Javascript! Please enable for correct functionality</noscript>

    <div id="navbar"></div>

    <table class="glasspanel" style="border-collapse: separate;border-spacing:.5em;font-family:Timeburner;text-align:center;z-index:100;margin:auto;margin-top:5%;">
      <tr>
        <td></td>
        <td>
          <button value="up" class="btn btn-default btn-xlg btn-block xyc">UP</button>
        </td>
        <td></td>
      </tr>
      <tr>
        <td>
          <button value="left" class="btn btn-default btn-xlg btn-block xyc">LEFT</button>
        </td>
        <td>
          <button value="center" class="btn btn-default btn-xlg btn-block xyc">CENTER</button>
        </td>
        <td>
          <button value="right" class="btn btn-default btn-xlg btn-block xyc">RIGHT</button>
        </td>
      </tr>
      <tr>
        <td>
          <button value="zero" class="btn btn-danger btn-xlg btn-block xyc">ZERO</button>
        </td>
        <td>
          <button value="down" class="btn btn-default btn-xlg btn-block xyc">DOWN</button>
        </td>
        <td>
        </td>
      </tr>
      <tr>
        <td colspan="2">
          <a href="/readings.csv" download>
            <button id="download" value="96" class="btn btn-warning btn-xlg btn-block csv" disabled>DOWNLOAD CSV</button>
          </a>
        </td>
        <td>
          <button id="reading" value="96" class="btn btn-success btn-xlg btn-block scan">SCAN</button>
        </td>
      </tr>
      <tr>
        <td colspan="3">
          <button id="ledtoggle" value="1" class="btn btn-info btn-xlg btn-block ledtoggle">TOGGLE LED</button>
          <td>
      </tr>
    </table>
</body>

</html>
